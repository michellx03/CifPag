<%@ page contentType="text/html;charset=UTF-8" language="java"%>
<%@taglib prefix="t" tagdir="/WEB-INF/tags"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>

<%@page import="javax.persistence.Query"%>
<%@page import="javax.persistence.EntityManager"%>

<%@page import="br.com.cifpag.uteis.ConexaoEntityFactory"%>
<%@page import="java.util.List"%>

<c:set var="bodyContent">


	<div class="page-bar">
		<ul class="page-breadcrumb">
			<li><a href="/CifPag/dashboard/index">Dashboard</a>
				<i class="fa fa-circle"></i></li>
			<li><a href="/CifPag/DadosUsuario/Consulta">Dados Usuario Consulta</a>
				<i class="fa fa-circle"></i></li>
			<li><span>Cadastro</span></li>
		</ul>
		<div class="page-toolbar"></div>
	</div>

	<!-- END PAGE BAR -->
	<!-- BEGIN PAGE TITLE-->
	<h1 class="page-title">
		Cadastro de Dadosd do usuario <small>Campos Obrigat√≥rios (*)</small>
	</h1>
	<!-- END PAGE TITLE-->
	<!-- END PAGE HEADER-->

	<div class="row">
		<div class="col-md-12">
			<!-- BEGIN VALIDATION STATES-->
			<div class="portlet light portlet-fit portlet-form bordered"
				id="form_wizard_1">

				<div class="row">
					<div class="col-md-12">
						<!-- BEGIN VALIDATION STATES-->
						<div class="portlet light portlet-fit portlet-form bordered">

							<div class="portlet-body">
								<!-- BEGIN FORM-->
								<form action="/CifPag/DadosUsuario/Salvar"
									id="form_sample_2" method="POST" class="form-horizontal">

									<input style="display: none" name="clieId" id="id"
										value="${dadosUsuario.clieId}">

									<div class="form-body">
										<div style="width: 90%; margin-left: 5%;"
											class="alert alert-danger display-hide">
											<button class="close" data-close="alert"></button>
											Por favor verifique os erros abaixo!
										</div>
										
										<div class="form-group  margin-top-20">
											<label class="control-label col-md-3">Nome Completo <span
												class="required"> * </span>
											</label>
											<div class="col-md-4">
												<div class="input-icon right">
													<i class="fa"></i> <input type="text" class="form-control" id="clieNome"
														name="clieNome"  value="${dadosUsuario.clieNome}" />
												</div>
											</div>
										</div>
										
										<div class="form-group  margin-top-20">
											<label class="control-label col-md-3">Data Nascimento <span
												class="required"> * </span>
											</label>
											<div class="col-md-4">
												<div class="input-icon right">
													<i class="fa"></i> <input type="date" class="form-control" id="clieDataNascimento"
														name="clieDataNascimento"  value="${dadosUsuario.clieDataNascimento}" />
												</div>
											</div>
										</div>
										
										<div class="form-group  margin-top-20">
											<label class="control-label col-md-3">Rg <span
												class="required"> * </span>
											</label>
											<div class="col-md-4">
												<div class="input-icon right">
													<i class="fa"></i> <input type="text" id="clieRg"
														class="form-control" value="${dadosUsuario.clieRg}"
														name="clieRg" />
												</div>
											</div>
										</div>
										
										<div class="form-group margin-top-20">
													<label for="single" class="control-label col-md-3">Selecione o tipo de pessoa</label>
												<div class="col-md-4">
													<div class="input-icon right">
															<select id="singleAlter" class="form-control select2" name="clieTipoPessoa">
															
																<% 	
																	EntityManager emTipoPessoa = new ConexaoEntityFactory().getEntityManager();
																	Query tipoPessoa = (Query) emTipoPessoa.createNativeQuery("SELECT tipo_id FROM sistema.tipo_pessoa INNER JOIN sistema.dados_usuario ON clie_id = tipo_id WHERE clie_id = " + request.getParameter("id"));
																	Object tipoTipoPessoa = tipoPessoa.getSingleResult();
																	
																	Query queryListaTipoPessoa = (Query) emTipoPessoa.createNativeQuery("SELECT tipo_id, tipo_tipo_pessoa FROM sistema.tipo_pessoa WHERE tipo_id = " + tipoTipoPessoa);
																	List<Object[]> listTipoPessoa = queryListaTipoPessoa.getResultList();
																	for (Object[] obj : listTipoPessoa) { 
																%>
																<option value="<%out.print(obj[0]);%>"><%out.print(obj[1]);%></option>	
																
																<%
																	Query todasPessoas = (Query) emTipoPessoa.createNativeQuery("SELECT tipo_id, tipo_tipo_pessoa FROM sistema.tipo_pessoa WHERE tipo_id != " + tipoTipoPessoa);
																	List<Object[]> listTipos = todasPessoas.getResultList();
																	for (Object[] objTipoPessoa : listTipos) {
																%>		
																		<option value="<%out.print(objTipoPessoa[0]);%>"><%out.print(objTipoPessoa[1]);%></option>
																<%			
																	}
																%>
																														
																<%
																	}
																%>	

															</select>
														</div>
													</div>	
												</div>

										
										<div class="form-group  margin-top-20">
											<label class="control-label col-md-3">CPF <span
												class="required"> * </span>
											</label>
											<div class="col-md-4">
												<div class="input-icon right">
													<i class="fa"></i> <input type="text" id="clieCpf"
														class="form-control" value="${dadosUsuario.clieCpf}"
														name="clieCpf" />
												</div>
											</div>
										</div>
										
										<div class="form-group  margin-top-20">
											<label class="control-label col-md-3">CNPJ <span
												class="required"> * </span>
											</label>
											<div class="col-md-4">
												<div class="input-icon right">
													<i class="fa"></i> <input type="text" id="clieCnpj"
														class="form-control" value="${dadosUsuario.clieCnpj}"
														name="clieCnpj" />
												</div>
											</div>
										</div>
										
										<div class="form-group  margin-top-20">
											<label class="control-label col-md-3">Nome Fantasia <span
												class="required"> * </span>
											</label>
											<div class="col-md-4">
												<div class="input-icon right">
													<i class="fa"></i> <input type="text" id="clieNomeFantasia"
														class="form-control" value="${dadosUsuario.clieNomeFantasia}"
														name="clieNomeFantasia" />
												</div>
											</div>
										</div>
										
										<div class="form-group  margin-top-20">
											<label class="control-label col-md-3">Endereco <span
												class="required"> * </span>
											</label>
											<div class="col-md-4">
												<div class="input-icon right">
													<i class="fa"></i> <input type="text" id="clieEndereco"
														class="form-control" value="${dadosUsuario.clieEndereco}"
														name="clieEndereco" />
												</div>
											</div>
										</div>
										
										<div class="form-group  margin-top-20">
											<label class="control-label col-md-3">Celular <span
												class="required"> * </span>
											</label>
											<div class="col-md-4">
												<div class="input-icon right">
													<i class="fa"></i> <input type="text" id="clieCelular"
														class="form-control" value="${dadosUsuario.clieCelular}"
														name="clieCelular" />
												</div>
											</div>
										</div>
										
										<div class="form-group  margin-top-20">
											<label class="control-label col-md-3">Telefone <span
												class="required"> * </span>
											</label>
											<div class="col-md-4">
												<div class="input-icon right">
													<i class="fa"></i> <input type="text" id="clieTelefone"
														class="form-control" value="${dadosUsuario.clieTelefone}"
														name="clieTelefone" />
												</div>
											</div>
										</div>
										
									</div>

									<div class="form-actions">
										<div class="row">
											<div class="col-md-offset-3 col-md-9">
												<button type="submit" class="btn green">
													<%
														if (request.getParameter("id") == null) {
																out.print("Cadastrar");
															} else {
																out.print("Alterar");
															}
													%>
												</button>
											</div>
										</div>
									</div>
								</form>
								<!-- END FORM-->
							</div>
						</div>
						<!-- END VALIDATION STATES-->
					</div>
				</div>
			</div>
		</div>
	</div>



</c:set>
<t:master>

	<jsp:attribute name="scripts_css">
        
</jsp:attribute>

	<jsp:attribute name="scripts_js_page_level_plugins">

        <script
			src="/CifPag/assets/global/plugins/jquery-validation/js/jquery.validate.min.js"
			type="text/javascript"></script>
<script
			src="/CifPag/assets/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js"
			type="text/javascript"></script>
                       
</jsp:attribute>
	<jsp:attribute name="scripts_js_page_level_scripts">
	
	<script>
			$(document).ready(function(){	
				$("#single").select2();	
				$("#singleAlter").select2();	
			});
		</script>
	
	<script>
		$(document).ready(function() {
			$("#usuarioli").addClass('active open');
			$("#dados_usuario_acesso_li_consulta").addClass('active open');
			
			
			if( $("#imgDaTela").attr("src") == ""){
				$("#imgDaTela").hide();
			}
			
			$("#imagem").change(function(){
				
				var file = document.querySelector('#imagem').files[0];
				getBase64(file);
				
			});

		});
		
		function getBase64(file) {
	           var reader = new FileReader();
	           reader.readAsDataURL(file);
	           reader.onload = function () {
	             console.log(reader.result.length);
	             $("#fotoParaSubir").val(reader.result);
	             $("#imgDaTela").attr("src",reader.result);
	             $("#imgDaTela").show();
	          
	           };
	           reader.onerror = function (error) {
	             console.log('Error: ', error);
	           };
	        }

	       
	
		
	</script>

<script
			src="/CifPag/assets/pages/scripts/form-validation.min.js"
			type="text/javascript"></script>
        			
                
</jsp:attribute>
	<jsp:body>
${bodyContent}    
</jsp:body>
</t:master>


